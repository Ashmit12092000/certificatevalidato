<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Report: {{ customer.name }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; }
        h1, h2, h3 { color: #1a202c; }
        h1 { text-align: center; margin-bottom: 30px; }
        .section { margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .section:last-child { border-bottom: none; }
        p { margin-bottom: 5px; }
        .label { font-weight: bold; width: 120px; display: inline-block; }
        .certificate-list { list-style: none; padding: 0; }
        .certificate-item { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
        .granted-modules { margin-top: 10px; font-size: 0.9em; }
        .granted-modules ul { list-style: disc; margin-left: 20px; }
        .header-info { text-align: right; font-size: 0.9em; color: #555; margin-bottom: 20px; }
        @media print {
            body { margin: 0; }
            .container { width: 100%; margin: 0; padding: 0; }
            .section { page-break-inside: avoid; }
            .certificate-item { page-break-inside: avoid; }
            button { display: none; } /* Hide print button when printing */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-info">
            Generated by: {{ user_email }} ({{ user_role }})<br>
            Date: {{ current_date }}
        </div>

        <h1>Customer Report</h1>

        <div class="section">
            <h2>Customer Details</h2>
            <p><span class="label">Name:</span> {{ customer.name }}</p>
            <p><span class="label">Code:</span> {{ customer.code }}</p>
            <p><span class="label">Status:</span> {{ customer.status }}</p>
            <p><span class="label">Email:</span> {{ customer.email }}</p>
            <p><span class="label">Phone:</span> {{ customer.phone }}</p>
            <p><span class="label">PAN:</span> {{ customer.pan }}</p>
            <p><span class="label">GST:</span> {{ customer.gst }}</p>
            <p><span class="label">Address:</span> {{ customer.address }}</p>
        </div>

        <div class="section">
            <h2>Certificates ({{ certificates|length }})</h2>
            {% if certificates %}
                <ul class="certificate-list">
                    {% for cert in certificates %}
                        <li class="certificate-item">
                            <h3>{{ cert.cert_type }}</h3>
                            <p><span class="label">Status:</span> {{ cert.status }}</p>
                            <p><span class="label">Activation Date:</span> {{ cert.activation_date }}</p>
                            <p><span class="label">Expiration Date:</span> {{ cert.expiration_date }}</p>
                            <p><span class="label">Verified:</span> {% if cert.verified %}Yes{% else %}No{% endif %}</p>
                            {% if cert.final_notes %}
                                <p><span class="label">Final Notes:</span> {{ cert.final_notes }}</p>
                            {% endif %}

                            {% if cert.granted_software_modules %}
                                <div class="granted-modules">
                                    <strong>Granted Software/Modules:</strong>
                                    <ul>
                                        {% for item in cert.granted_software_modules | from_json %}
                                            <li>{{ item.software_name }} - {{ item.module_name }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No certificates found for this customer.</p>
            {% endif %}
        </div>

        <button onclick="window.print()" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;">Print Report</button>
    </div>
</body>
</html>
